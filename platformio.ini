; ===================================================================
; CONFIGURATION PLATFORMIO (Paramètres généraux)
; ===================================================================
[platformio]
description     = LED Garland Animation Controller     ; Description visible dans PIO Home
default_envs    = esp32devkitc                                    ; Environnement compilé par défaut

; ⚠️ IMPORTANT : Modifiez ces chemins lors de la duplication du projet
build_dir       = C:/pio_builds/LED-Garland-Anim/build                      ; Dossier où sont stockés les binaires compilés
build_cache_dir = C:/pio_builds/LED-Garland-Anim/cache                      ; Cache pour accélérer la re-compilation

; ===================================================================
; CONFIGURATION GLOBALE (S'applique à toutes les cartes)
; ===================================================================
[env]
framework       = arduino                                          ; Framework utilisé (Arduino Core)
monitor_speed   = 115200                                           ; Vitesse du port série (Serial Monitor)
upload_speed    = 921600                                           ; Vitesse d'upload (921600 est stable et rapide)

; Filtres pour améliorer la lisibilité du moniteur série
monitor_filters = 
    esp32_exception_decoder                                        ; Décode les crashs (Stack Trace) en lignes de code
    time                                                           ; Ajoute l'heure (timestamp) à chaque ligne de log

; Nettoyage des drapeaux de compilation par défaut (anciens C++)
build_unflags =
    -std=gnu++11                                                   ; Retire le support C++11 (trop vieux)
    -std=gnu++14                                                   ; Retire le support C++14 (vieux)

; Ajout des nouveaux drapeaux de compilation
build_flags =
    -std=gnu++17                                                   ; Force l'utilisation de C++17 (moderne)
    -D PROJECT_VERSION='"0.6.2"'                                   ; Définit la version accessible dans le code
    -D PROJECT_NAME='"LED-Garland-Anim"'                           ; Définit le nom du projet accessible dans le code

; Gestion des bibliothèques externes
lib_deps =
    ; --- NOYAU (Indispensables) ---
    adafruit/Adafruit NeoPixel @ ^1.12.0                           ; Gestion des LEDs RGB (ex: Pin 48 sur S3)
    bblanchon/ArduinoJson @ ^7.0.3                                 ; Manipulation facile de JSON (Config/API)
    mathertel/OneButton @ ^2.5.0                                   ; Gestion boutons poussoirs (Clic/Double/Long)

    ; --- UTILITAIRES COMMUNS (Décommenter si besoin) ---
    ; adafruit/Adafruit BusIO @ ^1.17.4                            ; Requis par la plupart des capteurs I2C Adafruit
    ; adafruit/Adafruit SPIFlash @ ^3.6.1                          ; Gestion mémoire flash SPI externe
    ; lorol/LittleFS_esp32 @ ^1.1.0                                ; Système de fichiers LittleFS pour ESP32
    
    
    ; --- AFFICHAGE (Décommenter au besoin) ---
    adafruit/Adafruit GFX Library @ ^1.11.9                        ; Base graphique pour écrans Adafruit
    adafruit/Adafruit SSD1306 @ ^2.5.9                             ; Pilote pour écrans OLED monochromes
    adafruit/Adafruit ST7735 and ST7789 Library @ ^1.11.0          ; Pour écrans ST7789 (TFT couleur)
    ; olikraus/U8g2 @ ^2.36.15                                     ; Librairie graphique universelle (très complète)

    ; --- CAPTEURS (Décommenter selon le projet) ---
    ; adafruit/Adafruit Unified Sensor @ ^1.1.10                   ; Capteur abstrait
    ; adafruit/Adafruit BusIO@^1.17.4                              ; I2C/SPI abstraitr
    ; adafruit/Adafruit BMP280 Library @ ^2.3.0                    ; Capteur Temp/Pression
    ; adafruit/Adafruit DHT Unified Sensor @ ^1.4.1                ; Capteur Temp/Humidité DHTxx

; ===================================================================
; ENVIRONNEMENT : ESP32-S3 N16R8 (Cible Principale - 16MB Flash / 8MB PSRAM)
; ===================================================================
[env:esp32s3_n16r8]
platform      = espressif32@^6                                     ; Version du package ESP32 (Stable v6.x)
board         = esp32-s3-devkitc-1                                 ; Définition de la carte physique

build_flags =
    ${env.build_flags}                                             ; Récupère les flags globaux définis plus haut
    -D TARGET_ESP32_S3                                             ; Macro pour identifier cette carte dans le code
    ; --- Configuration PSRAM (RAM Externe) ---
    -DCONFIG_SPIRAM_BOOT_INIT                                      ; Initialise la PSRAM au démarrage
    -DCONFIG_SPIRAM_USE                                            ; Autorise l'usage de la PSRAM
    -DCONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY                  ; Autorise les variables globales en PSRAM
    -DCONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY                    ; Autorise la pile (stack) en PSRAM (Rare)
    -DBOARD_HAS_PSRAM                                              ; Indique à Arduino que la PSRAM est présente
    ; --- Configuration USB Natif (S3 uniquement) ---
    -DARDUINO_USB_CDC_ON_BOOT=1                                    ; Active le Serial sur l'USB natif au boot
    -DARDUINO_USB_MODE=1                                           ; Mode USB Hardware

; Configuration de la mémoire Flash et PSRAM
board_build.flash_mode          = qio                              ; Quad I/O (Le plus rapide pour la flash)
board_build.flash_size          = 16MB                             ; Taille totale de la mémoire Flash
board_build.f_flash             = 80000000L                        ; Fréquence Flash (80MHz)
board_build.partitions          = huge_app.csv                     ; Table de partition (Plus de place pour l'app)
board_build.arduino.memory_type = qio_opi                          ; Type de mémoire S3 (Octal SPI pour PSRAM)
board_build.f_psram             = 80000000L                        ; Fréquence PSRAM (80MHz)
board_build.psram               = enabled                          ; Active la prise en charge PSRAM

; ===================================================================
; VARIANTE : ESP32-S3 N8R8 (8MB Flash / 8MB PSRAM)
; ===================================================================
[env:esp32s3_n8r8]
platform      = espressif32@^6                                     ; Version du package ESP32
board         = esp32-s3-devkitc-1                                 ; Même carte physique de base

build_flags =
    ${env.build_flags}                                             ; Récupère les flags globaux
    -D TARGET_ESP32_S3                                             ; Macro d'identification
    ; --- Configuration PSRAM (RAM Externe) ---
    -DCONFIG_SPIRAM_BOOT_INIT                                      ; Initialise la PSRAM au démarrage
    -DCONFIG_SPIRAM_USE                                            ; Autorise l'usage de la PSRAM
    -DCONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY                  ; Autorise les variables globales en PSRAM
    -DCONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY                    ; Autorise la pile (stack) en PSRAM
    -DBOARD_HAS_PSRAM                                              ; Indique à Arduino que la PSRAM est présente
    ; --- Configuration USB Natif (S3 uniquement) ---
    -DARDUINO_USB_CDC_ON_BOOT=1                                    ; Active le Serial sur l'USB natif au boot
    -DARDUINO_USB_MODE=1                                           ; Mode USB Hardware

; Configuration de la mémoire Flash et PSRAM
board_build.flash_mode          = qio                              ; Quad I/O (Le plus rapide pour la flash)
board_build.flash_size          = 8MB                              ; Taille totale de la mémoire Flash (8MB)
board_build.f_flash             = 80000000L                        ; Fréquence Flash (80MHz)
board_build.partitions          = huge_app.csv                     ; Table de partition (Plus de place pour l'app)
board_build.arduino.memory_type = qio_opi                          ; Type de mémoire S3 (Octal SPI pour PSRAM)
board_build.f_psram             = 80000000L                        ; Fréquence PSRAM (80MHz)
board_build.psram               = enabled                          ; Active la prise en charge PSRAM

; ===================================================================
; VARIANTE : ESP32-DevKitC Classique (WROOM-32 standard)
; ===================================================================
[env:esp32devkitc]
platform      = espressif32@^6                                     ; Version du package ESP32
board         = esp32dev                                           ; Carte ESP32 standard (souvent Board v4)

build_flags =
    ${env.build_flags}                                             ; Récupère les flags globaux
    -D TARGET_ESP32_CLASSIC                                        ; Macro d'identification pour le code

board_build.flash_size    = 4MB                                    ; Flash standard de 4MB
board_build.partitions    = default.csv                            ; Partitionnement par défaut